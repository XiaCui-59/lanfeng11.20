(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"1b6c":function(t,e,n){"use strict";n.r(e);var o=n("faf5"),i=n.n(o);for(var s in o)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=i.a},6876:function(t,e,n){"use strict";(function(t,e){var o=n("47a9");n("ad3b");o(n("3240"));var i=o(n("e035"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"78f5":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}));var o={uNavbar:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-navbar/u-navbar")]).then(n.bind(null,"1f97"))},uPopup:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(n.bind(null,"2b09"))},uCellGroup:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-cell-group/u-cell-group")]).then(n.bind(null,"d727"))},uCell:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(n.bind(null,"80c3"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.ifSingle?null:t.__map(t.historyList,(function(e,n){var o=t.__get_orig(e),i="text"==e.msg_type?e.content.replace(/\\n/g,"\n"):null,s="voice"==e.msg_type?Math.ceil(20*e.voice.second):null,c="voice"==e.msg_type?Math.ceil(e.voice.second):null;return{$orig:o,g0:i,g1:s,g2:c}}))),o=t.ifSingle?null:t.__map(t.qaList,(function(e,n){var o=t.__get_orig(e),i="text"==e.msg_type?e.content.replace(/\\n/g,"\n"):null,s="voice"==e.msg_type?Math.ceil(20*e.voice.second):null,c="voice"==e.msg_type?Math.ceil(e.voice.second):null;return{$orig:o,g3:i,g4:s,g5:c}}));t.$mp.data=Object.assign({},{$root:{l0:n,l1:o}})},s=[]},c6c8:function(t,e,n){"use strict";var o=n("fa2a"),i=n.n(o);i.a},e035:function(t,e,n){"use strict";n.r(e);var o=n("78f5"),i=n("1b6c");for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("c6c8");var c=n("828b"),a=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=a.exports},fa2a:function(t,e,n){},faf5:function(t,e,n){"use strict";(function(t,o){var i=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(n("7eb4")),c=i(n("ee10")),a=i(n("f3b0")),r=requirePlugin("WechatSI"),l=(r.getRecordRecognitionManager(),getApp()),u={data:function(){return{maskStartPoint:{},maskEndPoint:{},showLogin:!1,menuList:[{text:"钱包余额",url:"/pages/balance/balance",icon:"rmb-circle-fill",value:"0"},{text:"会员权益",url:"/pages/vip/vip",icon:"gift-fill",value:"成为会员"},{text:"邀请有礼",url:"/pages/invite2/invite2",icon:"share-fill",value:""},{text:"关于灵动优聘",url:"/pages/about/about",icon:"info-circle-fill",value:""}],showMenu:!1,title:"灵动优聘-优优",historyId:0,loadAllHistory:!1,showReAuth:!1,imgUrl:l.globalData.baseImageUrl,showTranIcon:!1,scrollView:"",ques:"",hold:"h1",qaList:[],socketOpen:!1,socketMsgQueue:[],canSend:!0,placeHolder:"想了解什么工作，请告诉我吧",qaListLen:0,historyList:[],scroll:0,connected:!1,connecting:!1,socketTask:!1,num:1,curStrIndex:0,marginTop:l.globalData.marginTop,tabMargin:l.globalData.tabMargin,subTabHeight:l.globalData.subTabHeight,showRecord:!1,showFullScreen:!0,showWanner:!1,cityData:[],city1:"",city2:"",city3:"",cityArr:[],typeTags:[],seleTypeIds:[],selectType:[],open_id:"",getPhoneData:{},showInputing:!1,enableSpeeking:!1,timer:null,currentSiging:{},showSetting:!1,openid:"",startPoint:{},cancelRecord:!1,titleHeight:0,showAnswering:!1,inputHeight:0,recordSecond:0,secondText:"00:00",secondTimer:null,cancelIconLeft:0,cancelIconRight:0,cancelIconBottom:0,cancelIconTop:0,manager:t.getRecorderManager(),voiceTime:0,Audio:t.createInnerAudioContext(),AudioExam:null,currentPlayType:"",currentPlayIndex:0,touchStartTime:0,touchEndTime:0,canRecord:!0,contentHeight:0,ifSingle:1154==l.globalData.scene,params:"",header:{},menuButtonInfo:l.globalData.menuButtonInfo,userInfo:{is_vip:!1},shareId:""}},onShareAppMessage:function(){return{title:"AI找工作，两句话的事儿",path:"/pages/index/index",imageUrl:l.globalData.baseImageUrl+"/worker/mini_share.jpg"}},onShareTimeline:function(){return{title:"AI找工作，两句话的事儿",path:"/pages/index/index",imageUrl:l.globalData.baseImageUrl+"/worker/mini_share.jpg"}},computed:{scrollHeight:function(){return this.contentHeight||300}},onLoad:function(e){var n=this;return(0,c.default)(s.default.mark((function o(){var i,c;return s.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(n.shareId=e.share_id?e.share_id:"",n.params=e,i=n,n.header={"content-type":"application/json","app-id":a.default.urls.appid,"open-id":t.getStorageSync("openid")?t.getStorageSync("openid"):"","ad-project-id":i.params.project?i.params.project:"","click-id":i.params.gdt_vid?i.params.gdt_vid:"","ad-platform":i.params.ad_platform?i.params.ad_platform:"","ad-sub-platform":i.params.platform?i.params.platform:""},console.log(n.ifSingle,"ifsingle"),!n.ifSingle){o.next=7;break}return o.abrupt("return");case 7:return o.next=9,n.getOpenId();case 9:return n.openid=o.sent,o.next=12,n.getHistory();case 12:n.historyList=o.sent,n.toScroll(),c=t.getMenuButtonBoundingClientRect(),n.titleHeight=c.height,n.title="灵动优聘-优优",t.onKeyboardHeightChange((function(t){console.log(t.height,"键盘高度变化"),0==t.height&&(n.inputHeight=0)})),n.manager.onStart((function(t){console.log("录音开始"),n.showInputing=!0,n.recordSecond=0,n.secondText="00:00",n.startCount(),n.getIconPosition()})),n.manager.onStop((function(e){var o=n;console.log("录音结束"),n.showInputing=!1,clearInterval(o.secondTimer),console.log("时间间隔:",n.touchEndTime-n.touchStartTime),n.touchEndTime-n.touchStartTime>1e3?n.handleRecorder(e):t.showToast({title:"长按时间过短",icon:"error"})})),n.manager.onError((function(t){var e=n;n.showInputing=!1,clearInterval(e.secondTimer),console.log("录音出错：",t.errMsg)})),n.Audio.onStop((function(t){n.closeAnmition()})),n.Audio.onEnded((function(t){n.closeAnmition()}));case 23:case"end":return o.stop()}}),o)})))()},onUnload:function(){this.close()},onShow:function(){this.isLogin()&&this.getInfo()},mounted:function(){var t=this;this.$nextTick((function(){t.getContentHeight()}))},components:{login:function(){n.e("components/login").then(function(){return resolve(n("2d80"))}.bind(null,n)).catch(n.oe)}},methods:{maskStart:function(t){console.log(t),this.maskStartPoint=t.touches[0]},maskEnd:function(t){console.log(t)},handleMaskMove:function(t){console.log(t),this.maskStartPoint.clientX-t.touches[t.touches.length-1].clientX>20&&this.closeMenu()},sendBtnMsg:function(t){this.ques=t,this.sendQuestion()},navigate:function(e){this.isLogin()?e?t.navigateTo({url:e}):t.showToast({title:"敬请期待",icon:"error",duration:2e3}):this.showLogin=!0},handleClick:function(e){console.log(e),"钱包余额"!=e.name&&"邀请有礼"!=e.name||t.showToast({title:"敬请期待",icon:"error",duration:2e3})},getInfo:function(){var e=this;this.$request("/worker/profile").then((function(n){0==n.code&&(t.setStorageSync("userInfo",JSON.stringify(n.data)),e.userInfo=n.data,e.menuList[0].value=n.data.balance)}))},closeLogin:function(){this.showLogin=!1},closeMenu:function(){this.showMenu=!1},openMenu:function(){this.isLogin()?(console.log("已登录"),this.showMenu=!0,t.showLoading(),setTimeout((function(){t.hideLoading()}),500)):(console.log("未登录"),this.showLogin=!0)},paramsPost:function(t){this.$request("/ad/tracking",this.params,"POST",t).then((function(t){0==t.code&&console.log("参数POST成功")}))},getContentHeight:function(){this.contentHeight=l.globalData.systemHeight-5*this.tabMargin-this.subTabHeight-this.marginTop},showTrans:function(t,e){t.showTranlate||("his"==e?this.historyList.forEach((function(e,n){e.id==t.id&&(e.showTranIcon=!0)})):this.qaList.forEach((function(e,n){e.id==t.id&&(e.showTranIcon=!0)})))},bodyClick:function(){this.historyList.forEach((function(t,e){t.showTranIcon=!1})),this.qaList.forEach((function(t,e){t.showTranIcon=!1}))},startTrans:function(e,n){var o=this;if(e.showTranIcon=!1,"his"==n)this.historyList.forEach((function(t,n){t.id==e.id&&(t.showTranlate=!0)}));else if(!e.showTranlate){o.qaList.forEach((function(t,n){t.id==e.id&&(t.showTransing=!0)}));var i="/ai/voice/"+e.id+"/recognize/result",s=setInterval((function(){o.$request(i).then((function(n){console.log(n,"查询结果"),0==n.code?n.data.content&&(e.content=n.data.content,o.qaList.forEach((function(t,n){t.id==e.id&&(t.showTranlate=!0,t.showTransing=!1)})),clearInterval(s)):(clearInterval(s),t.hideLoading())}))}),1e3)}},handleAudio:function(t,e,n){this.AudioExam=e,this.currentPlayType=t,this.currentPlayIndex=n,this.Audio.paused?this.playAudio(e):this.stopAudio(e)},playAudio:function(t){var e=this;this.Audio.src=t.voice.media.url,this.Audio.id=t.id,this.Audio.play(),"his"==this.currentPlayType?(this.historyList.forEach((function(t,n){"voice"==t.msg_type&&(n==e.currentPlayIndex?e.historyList[e.currentPlayIndex].voice.anmitionPlay=!0:e.historyList[n].voice.anmitionPlay=!1)})),this.qaList.forEach((function(t,n){"voice"==t.msg_type&&(e.qaList[n].voice.anmitionPlay=!1)}))):(this.qaList.forEach((function(t,n){"voice"==t.msg_type&&(n==e.currentPlayIndex?e.qaList[e.currentPlayIndex].voice.anmitionPlay=!0:e.qaList[n].voice.anmitionPlay=!1)})),this.historyList.forEach((function(t,n){"voice"==t.msg_type&&(e.historyList[n].voice.anmitionPlay=!1)})))},stopAudio:function(t){var e=this;"his"==this.currentPlayType?(this.historyList[this.currentPlayIndex].voice.anmitionPlay=!1,this.qaList.forEach((function(t,n){"voice"==t.msg_type&&(e.qaList[n].voice.anmitionPlay=!1)}))):(this.qaList[this.currentPlayIndex].voice.anmitionPlay=!1,this.historyList.forEach((function(t,n){"voice"==t.msg_type&&(e.historyList[n].voice.anmitionPlay=!1)}))),this.Audio.src="",this.Audio.stop()},closeAnmition:function(){var t=this,e=this.Audio.id;"his"==this.currentPlayType?this.historyList.forEach((function(n,o){"voice"==n.msg_type&&n.id==e&&(t.historyList[o].voice.anmitionPlay=!1)})):this.qaList.forEach((function(n,o){"voice"==n.msg_type&&n.id==e&&(t.qaList[o].voice.anmitionPlay=!1)})),this.currentPlayType="",this.currentPlayIndex=0},handleRecorder:function(e){var n=e.tempFilePath,i=e.duration,s=this;console.log("tempFilePath",n),console.log("duration",i),this.voiceTime=0,i<600?t.showToast({title:"说话时间过短",icon:"error",duration:2e3}):(this.showInputing=!1,this.cancelRecord||o.getFileSystemManager().readFile({filePath:n,success:function(e){var o=e.data,c=new Uint8Array(o),a=(new Date).getTime(),r=t.getStorageSync("openid")+a,l=s.stringToUint8Array(r+"@@@");console.log(l.length,c.length);var u=l.length+c.length,h=new Uint8Array(u),d=0;h.set(l,d),d+=l.length,h.set(c,d);var g={id:r,content:"",origin:"customer",msg_type:"voice",voice:{media:{key:"",url:n},second:i/1e3,anmitionPlay:!1},showTranIcon:!1,showTranlate:!1,showTransing:!1};s.send(h.buffer,g,"voice")},fail:function(t){console.error("读取文件失败：",t)}}))},stringToUint8Array:function(t){for(var e=unescape(encodeURIComponent(t)),n=e.length,o=new Uint8Array(n),i=0;i<n;i++)o[i]=e.charCodeAt(i);return o},getOpenId:function(){var e=this,n=this;return new Promise((function(o){t.login({success:function(i){if(console.log(i,"dyres"),"login:ok"==i.errMsg){var s={code:i.code};"/auth/worker/wechat/mini/openid",e.$request("/auth/worker/wechat/mini/openid",s,"POST",n.header).then((function(e){0==e.code&&(t.setStorage({key:"openid",data:e.data.open_id}),n.header["open-id"]=e.data.open_id,n.paramsPost(n.header),o(e.data.open_id))}))}},fail:function(t){console.log(t,"接口调用失败")}})}))},getIconPosition:function(){var e=this,n=t.createSelectorQuery().in(e);n.select(".cancel_icon").boundingClientRect((function(t){console.log("querydata",t),t&&(console.log("元素的位置信息：",t),e.cancelIconTop=t.top,e.cancelIconBottom=t.top+t.width,e.cancelIconLeft=t.left,e.cancelIconRight=t.right)})).exec()},keyboardHeightChange:function(t){console.log(t,"键盘")},inputBindFocus:function(t){t.detail.height&&(this.inputHeight=t.detail.height)},startCount:function(){this.recordSecond=0;var e=this;this.secondTimer=setInterval((function(){console.log("recordSecond:",e.recordSecond),e.recordSecond<60?(e.recordSecond++,e.recordSecond<10?e.secondText="00:0"+e.recordSecond:e.secondText="00:"+e.recordSecond):(clearInterval(e.secondTimer),t.showToast({title:"最多发送60s",duration:3e3,icon:"none"}),e.stopRecord())}),1e3)},handleTouchMove:function(t){var e=t.touches[t.touches.length-1].clientX>this.cancelIconLeft&&t.touches[t.touches.length-1].clientX<this.cancelIconRight,n=t.touches[t.touches.length-1].clientY>this.cancelIconTop&&t.touches[t.touches.length-1].clientY<this.cancelIconBottom;this.cancelRecord=!(!e||!n)},openSetting:function(){var e=this;t.openSetting({success:function(t){console.log(t.authSetting,"res.authSetting"),t.authSetting["scope.record"]&&(e.showSetting=!1)},fail:function(t){console.log(t,"openerr")},complete:function(){this.showReAuth=!1}})},startRecord:function(e){this.touchStartTime=e.timeStamp,this.Audio.paused||this.stopAudio(this.AudioExam),t.vibrateShort({success:function(){console.log("success")}}),this.startPoint=e.touches[0],this.cancelRecord=!1,this.manager.start({duration:6e4,lang:"zh_CN"})},stopRecord:function(t){var e=this;this.touchEndTime=t.timeStamp,this.touchEndTime-this.touchStartTime>1e3?(this.showInputing=!1,this.manager.stop()):setTimeout((function(){e.manager.stop()}),1e3)},cancelVoice:function(t){console.log("touch取消"),this.voiceTime=0,this.recordSecond=0,this.showInputing=!1,this.manager.stop()},showAichat:function(){var e=this;return(0,c.default)(s.default.mark((function n(){var o;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.historyId=0,e.historyList=[],e.loadAllHistory=!1,e.qaList=[],o=e,t.authorize({scope:"scope.record",success:function(t){console.log(t,"success")},fail:function(t){o.showSetting=!0,console.log(t,"err")}}),n.next=8,e.getHistory();case 8:e.historyList=n.sent,e.toScroll(),e.creatConnect();case 11:case"end":return n.stop()}}),n)})))()},openSeepking:function(){this.enableSpeeking=!this.enableSpeeking},toInput:function(){this.showRecord=!1},toVoice:function(){var e=this;t.authorize({scope:"scope.record",success:function(t){console.log(t,"success")},fail:function(t){e.showSetting=!0,console.log(t,"err")}}),this.showRecord=!0},doSend:function(t,e){t.ctrlKey&&13===t.keyCode?this.ques+="\n":void 0!==t&&(this.sendQuestion(),t.preventDefault())},legal:function(){this.age&&(Number(this.age)||t.showModal({title:"输入不合法，请输入大于18的数字。",showCancel:!1}))},getHistory:function(){t.showLoading();var e=this;return new Promise((function(t){var n="/ai/chat/histories?id="+e.historyId;e.$request(n).then((function(n){if(0==n.code){var o=n.data.reverse(),i=n.data.length;i>0&&(e.historyId=n.data[0].id),o=e.handleList(o),t(o)}}))}))},getMoreHistory:function(){var e=this;if(this.loadAllHistory)t.showToast({title:"已加载全部",icon:"none",duration:2e3});else{t.showLoading();var n="/ai/chat/histories?id="+this.historyId;this.$request(n).then((function(n){if(0==n.code){t.hideLoading();var o=n.data.reverse(),i=e.handleList(o);e.historyList=i.concat(e.historyList);var s=n.data.length;s>0?e.historyId=n.data[0].id:e.loadAllHistory=!0}}))}},handleList:function(t){for(var e=t.length,n=0;n<e;n++)"voice"==t[n].msg_type&&(t[n].voice.anmitionPlay=!1,t[n].showTranlate=!1,t[n].showTranIcon=!1);return console.log("arr:",t),t},toScroll:function(){var e=this;this.$nextTick((function(){if(console.log(123),0==e.qaList.length){var n=e.historyList.length-1;n>=0&&setTimeout((function(){e.scrollView="his"+n,t.hideLoading()}),500)}else{var o=e.qaList.length-1;setTimeout((function(){e.scrollView="qa"+o,t.hideLoading()}),500)}console.log(e.scrollView,"scrollView")}))},sendQuestion:function(){if(this.curStrIndex=0,this.ques){if(this.inputHeight=0,this.canSend){this.canSend=!1;var e={content:this.ques,origin:"customer",msg_type:"text"};this.send(this.ques,e,"")}}else t.showToast({icon:"none",title:"想了解什么工作，请告诉我吧"})},creatConnect:function(){if(this.connected||this.connecting)return!1;this.connecting=!0,console.log(l.globalData.wssUrl,"wss"),this.socketTask=t.connectSocket({url:l.globalData.wssUrl,header:this.header,method:"GET",success:function(t){console.log("链接成功")},fail:function(e){t.showModal({title:e.errMsg})}}),this.connect(),console.log(this.socketTask,"socketTask")},connect:function(){var e=this,n=this;this.socketTask.onOpen((function(t){e.connecting=!1,e.connected=!0,e.noInput(),console.log("onOpen",t)})),this.socketTask.onError((function(n){e.connecting=!1,e.connected=!1,e.canSend=!0,t.hideLoading(),console.log("onError",n),e.creatConnect()})),this.socketTask.onMessage((function(o){var i=JSON.parse(o.data);t.hideLoading(),n.showAnswering=!1,console.log(i,"respone"),0==i.code?"pong"!=i.data.content&&i.data.content&&(n.qaList.push(i.data),n.toScroll(),n.enableSpeeking&&n.formatResultStr(i.data.content)):t.showModal({title:i.msg}),e.resetData()})),this.socketTask.onClose((function(o){t.hideLoading(),e.connected=!1,e.socketTask=!1,console.log("onClose",o),clearInterval(n.timer),e.creatConnect()})),console.log("task",this.socketTask)},resetData:function(){this.canSend=!0,this.placeHolder="想了解什么工作，请告诉我吧",this.cancelRecord=!1},noInput:function(){var t=this;this.timer=setInterval((function(){t.send("ping","","")}),1e4)},formatResultStr:function(t){t&&this.speeking(t)},speeking:function(t){console.log(t,"播报内容"),r.textToSpeech({lang:"zh_CN",content:t,success:function(t){0==t.retcode?(console.log("result",t.result),o.playBackgroundAudio({dataUrl:t.filename,title:""})):console.warn("翻译失败",t)},fail:function(t){console.log("网络失败",t)}})},send:function(t,e,n){var o=this;this.socketTask.send({data:"voice"==n?t:JSON.stringify({content:t}),success:function(n){console.log(t,"data"),"ping"!=t&&(o.cancelRecord||(o.showAnswering=!0,o.qaList.push(e),o.num++,o.hold="h"+o.num,o.toScroll(),o.ques="",o.placeHolder="正在回答中，请稍后...",o.qaListLen=o.qaList.length))},fail:function(t){console.log(t)}})},close:function(){this.socketTask&&this.socketTask.close&&this.socketTask.close()},cancel:function(){this.showWanner=!1,this.toScroll()},noPosition:function(){this.showReAuth=!1}}};e.default=u}).call(this,n("df3c")["default"],n("3223")["default"])}},[["6876","common/runtime","common/vendor"]]]);