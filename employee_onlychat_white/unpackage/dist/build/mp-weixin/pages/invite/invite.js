(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/invite/invite"],{"07c6":function(e,t,n){"use strict";var o=n("ffb8"),i=n.n(o);i.a},6153:function(e,t,n){"use strict";n.r(t);var o=n("e33f"),i=n("8504");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("07c6");var s=n("828b"),r=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=r.exports},"6b5d":function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("2ed8");o(n("3240"));var i=o(n("6153"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},8504:function(e,t,n){"use strict";n.r(t);var o=n("fa85"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},e33f:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uNavbar:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-navbar/u-navbar")]).then(n.bind(null,"7689"))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"a30c"))},uGrid:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-grid/u-grid")]).then(n.bind(null,"7035"))},uGridItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-grid-item/u-grid-item")]).then(n.bind(null,"d7d2"))},lPainter:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/lime-painter/components/l-painter/l-painter")]).then(n.bind(null,"aba9"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.ifSingle?null:e.__map(e.list,(function(t,n){var o=e.__get_orig(t),i=e.list.length;return{$orig:o,g0:i}}))),o=e.ifSingle?null:e.list.length,i=e.ifSingle?null:e.shareList.slice(0,1),a=e.ifSingle?null:e.shareList.slice(1);e._isMounted||(e.e0=function(t,n){var o=arguments[arguments.length-1].currentTarget.dataset,i=o.eventParams||o["event-params"];n=i.listItem;return e.handleClick(n)}),e.$mp.data=Object.assign({},{$root:{l0:n,g1:o,l1:i,l2:a}})},a=[]},fa85:function(e,t,n){"use strict";(function(e){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("7eb4")),a=o(n("ee10")),s=getApp(),r={data:function(){return{shareId:"",showLogin:!1,ifSingle:1154==s.globalData.scene,fromSingle:1155==s.globalData.scene,showTips:!1,showMask:!0,showMethods:!0,showHaibao:!1,poster:{css:{},views:[]},imgUrl:s.globalData.baseImageUrl,marginTop:s.globalData.marginTop,tabMargin:s.globalData.tabMargin,shareParams:{way_wechat_friend:"",way_wechat_moment:"",way_qrcode:""},shareList:[{icon:s.globalData.baseImageUrl+"/worker/ic_share_chat.png",title:"微信好友"},{icon:s.globalData.baseImageUrl+"/worker/ic_share_friend.png",title:"朋友圈"},{icon:s.globalData.baseImageUrl+"/worker/ic_share_code.png",title:"生成海报"}],list:[],topAreaBottom:0,contBotHeight:0,scrollHeight:0,currentPage:1,pagination:{},staticsInfo:{invitation_total:0,"vip_reward_amount ":"0",vip_total_num:0}}},components:{login:function(){n.e("components/login").then(function(){return resolve(n("511f"))}.bind(null,n)).catch(n.oe)}},onLoad:function(t){var n=this;return(0,a.default)(i.default.mark((function o(){var a,r;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ff0000"}),n.shareId=t.share_id?t.share_id:"",!n.ifSingle){o.next=4;break}return o.abrupt("return");case 4:if(!n.fromSingle){o.next=8;break}return s.globalData.scene=0,e.redirectTo({url:"/pages/index/index?share_id="+n.shareId}),o.abrupt("return");case 8:return o.next=10,n.getElementInfo(".cont_header");case 10:return a=o.sent,a&&(n.topAreaBottom=a.bottom,n.contBotHeight=s.globalData.systemHeight-n.topAreaBottom),o.next=14,n.getElementInfo(".cont_bot_fixed");case 14:r=o.sent,r&&(n.scrollHeight=s.globalData.systemHeight-r.bottom-15),n.isLogin()&&(n.getStatics(),n.getList());case 17:case"end":return o.stop()}}),o)})))()},methods:{handleLogin:function(){this.getList(),this.chooseMethod()},closeLogin:function(){this.showLogin=!1},handleClick:function(e){console.log(e),"生成海报"==e.title?this.creatHaibao():(this.closeMethods(),this.showMask=!0,this.showTips=!0)},handleLongPress:function(){var t=this;e.showModal({title:"是否保存海报到相册？",confirmText:"保存",success:function(e){e.confirm&&t.save()}})},closeAll:function(){this.showMask=!1,this.showMethods=!1,this.showHaibao=!1,this.showTips=!1},chooseMethod:function(){this.isLogin()?(this.showMask=!0,this.showMethods=!0):this.showLogin=!0},readRule:function(){e.navigateTo({url:"/pages/invite_rule/invite_rule"})},getList:function(){var e=this,t="/worker/invite-list?page="+this.currentPage;this.$request(t).then((function(t){0==t.code&&(console.log(t.data.list),e.list=e.list.concat(t.data.list),e.pagination=t.data.pagination)}))},getStatics:function(){var e=this;this.$request("/worker/invite-statistics").then((function(t){0==t.code&&(e.staticsInfo=t.data)}))},getElementInfo:function(t){return new Promise((function(n){var o=e.createSelectorQuery().select(t);o.boundingClientRect((function(e){n(e)})).exec()}))},getShareParams:function(){var e=this;return new Promise((function(t){e.$request("/worker/shares").then((function(e){0==e.code&&t(e.data)}))}))},closeHaibao:function(){this.showMask=!1,this.showHaibao=!1},scrolltolower:function(){this.currentPage<this.pagination.pageCount?(this.currentPage++,this.getList()):e.showToast({title:"到底啦~",icon:"none",duration:2e3})},save:function(){console.log(this.$refs.painter),this.$refs.painter.canvasToTempFilePathSync({fileType:"jpg",pathType:"url",quality:1,success:function(t){var n=t.tempFilePath;console.log("tempFilePath:",t.tempFilePath),e.saveImageToPhotosAlbum({filePath:n,success:function(){e.showToast({title:"图片已保存",duration:2e3})},fail:function(t){e.showModal({title:"保存失败",showCancel:!1})}})},fail:function(e){console.log(e,"err")}})},creatHaibao:function(){var t=this;return(0,a.default)(i.default.mark((function n(){var o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.closeMethods(),e.showLoading({title:"海报加载中"}),n.next=4,t.getShareParams();case 4:t.shareParams=n.sent,o=t.shareParams.way_qrcode,console.log(o),o?t.viewHaibao(o):(e.hideLoading(),e.showModal({title:"海报加载失败，请重试。",confirmText:"好的",showCancel:!1}));case 8:case"end":return n.stop()}}),n)})))()},closeMethods:function(){this.showMask=!1,this.showMethods=!1},viewHaibao:function(t){var n=this;this.poster.views=[{type:"image",src:s.globalData.baseImageUrl+"/worker/worker_poster.png?time="+(new Date).getTime(),css:{width:"100%",margin:"0 auto"}},{type:"view",css:{width:"90%",position:"absolute",top:"30%",left:"50%",transform:"translateX(-50%)"},views:[{type:"image",src:t,css:{width:"45%",borderRadius:"50%",display:"inline-block",position:"absolute",top:"40%",left:"50%",transform:"translateX(-50%)"}}]}],this.$nextTick((function(){console.log("DOM 更新完成"),n.showMask=!0,n.showHaibao=!0,e.hideLoading()}))}}};t.default=r}).call(this,n("df3c")["default"])},ffb8:function(e,t,n){}},[["6b5d","common/runtime","common/vendor"]]]);